
#API

## callstats.initialize() 

- Authenticates with the callstats.io backend to setup a trusted relationship with it.
  
  Params  |  Argument | Type | Description
-----------  | ----------- | -------- | ---------- 
`AppID`  | Required | String | Application ID is obtained from callstats.io.
`AppSecret`  | Required | String | Application secret is obtained from callstats.io.
`localUserID`  | Required | String (256 bytes) | it is provided by the developer and MUST NOT be null or empty.
`initCallback`  | Optional | callback | asynchronously reports failure or success of the protocol messages.
`statsCallback`  | Optional | callback | asynchronously reports the conference statistics.  
`configParams`  | Optional | JSON| it is the set of parameters to enable/disable certain features in the library. 

Section on [generating userID](#generating-userid-and-conferenceid) provides more guidelines on choosing a `localUserID`.

### JSON for configParams

It provides developers a method to enable or disable certain features or functions within the callstats.js library. It is a javascript object with the following OPTIONAL key-value pairs. They are:

  Keys  |  Required | Description
-----------  | -------- | ---------- 
`disableBeforeUnloadHandler` | No | by default the valus is `false`, Setting it to `true` disengages callstats.js's `window.onbeforeunload` handler, and you will need to send the fabricTerminated event for each active peerconnection. See [Step 5](#step-5-optional-conference-events) for more details on `fabricTerminated` event.
`applicationVersion` | No | String of maximum length **30 characters**. If the value is `empty`, `undefined`, or `null`, the dashboard will show an empty string.

```javascript
var configParams = {
  disableBeforeUnloadHandler: true, // disables callstats.js's window.onbeforeunload parameter.
  applicationVersion: "app_version" // Application version specified by the developer.
};
```

## callstats.addNewFabric()
- Indicates that the WebRTC application intends to monitor the performance of the _PeerConnection_ between the two endpoints (represented by the corresponding UserIDs).
- Status: `implemented`
  
  Params | Description
---------  | -----------
pcObject  | pass the _PeerConnection_ object created after invoking `RTCPeerConnection()`."
remoteUserID  | of type _String_, maximum length **256 bytes**. It is generated by the origin server and MUST NOT be null or empty.
fabricUsage  | an Enumeration, with valid values values discussed in a later section.
conferenceID  | of type _String_, maximum length **512 bytes**. It is generated by the origin server and MUST NOT be null or empty.
pcCallback  | providing a callback function is OPTIONAL, the callback asynchronously reports failure or success. 

## callstats.reportError()
- Notifies the callstats.io backend about conference setup failure associated with reason."
- Status: `implemented`

  Params | Description
---------  | -----------
pcObject  | SHOULD pass the _PeerConnection_ object on which the failure occurred, however it MAY be set to null when passing in errors that occur when _getUserMedia()_ is called.
conferenceID  | of type _String_, maximum length **512 bytes**. It is generated by the origin server and MUST NOT be null or empty.
wrtcFuncName  | an Enumeration, where the failure occurred."
domError  | pass the DOMError object received in the callback associated with the WebRTC API/function.
localSDP  | pass the local SDP when errors occur before or during setLocalDescription() is executed. It MAY be set to NULL, in case you do not want SDPs to be collected.
remoteSDP  | pass the remote SDP when errors occur during `createAnswer()`. It MAY be set to NULL, in case you do not want SDPs to be collected.

## callstats.associateMstWithUserID()
- Maps the SSRCs to a userID when multiple _MediaStreamTracks_ (MSTs) are sent or received in a single _PeerConnection_.
- Status: `implemented`
 
   Params | Description
---------  | -----------
pcObject  | pass the _PeerConnection_ object on which the _MediaStreamTracks_ are being sent.
userID  | of type _String_, maximum length **256 bytes**. It is generated by the origin server and MUST NOT be null or empty.
conferenceID  | of type _String_, maximum length **512 bytes**. It is generated by the origin server and MUST NOT be null or empty.
ssrc  | Synchronization Source Identifier, as defined in [RFC3550](https://tools.ietf.org/html/rfc3550). It is typically generated by the user-agent and MUST not be null or empty.
usageLabel  | of type _String_, maximum length **20 bytes**. It is generated by the origin server and MUST not be null or empty. For example, it can be set to `front-camera`, `back-camera`, `screen`, `audio-in`, `mic`, `system-sound`, enumeration-of-wrtcfuncname.
associatedVideoTag  | providing the associated `video tag id` attribute value. This is argument OPTIONAL.

## callstats.sendFabricEvent()
- Notifies the callstats.io backend about events (e.g., 'Hold', 'Mute', etc.) on a _PeerConnection_. It is usually generated due to local user interaction at a _PeerConnection_.
- Status: `implemented`

  Params | Description
---------  | -----------
pcObject  | pass the _PeerConnection_ object associated with the _fabricEvent_.
fabricEvent  | an Enumeration, with valid values discussed in a later section.
conferenceID  | of type _String_, maximum length **512 bytes**. It is generated by the origin server and MUST NOT be null or empty.

## callstats.sendUserFeedback()

- Send the feedback indicated by the user for a specific conferenceID.
- Status: `implemented`
 
   Params | Description
---------  | -----------
conferenceID  | of type _String_, maximum length **512 bytes**. It is generated by the origin server and MUST NOT be null or empty.
feedback  | is a JSON object.
pcCallback  | providing a callback function is OPTIONAL, the callback asynchronously reports failure or success. 



### JSON for `feedback`

Mandatory Keys:

- userID : of type _String_, maximum length **256 bytes**. It is generated by the origin server and MUST NOT be null or empty; discussed in a [later section](#generating-the-userid).
- overall: of type _Integer_, MUST be a value between 1-5. Typically the scores correspond to the [mean opinion score](https://en.wikipedia.org/wiki/Mean_opinion_score), in this case this value represents the overall quality perceived by the userID.

Optional Keys:

- audio, video, screen: similar to the definition of `overall`, except these values correspond to specific types of media streams.

---